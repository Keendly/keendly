@(subscriptions: List[controllers.model.FeedSubscription], zones: Map[String, Integer], formatter: java.time.format.DateTimeFormatter)(implicit session: play.mvc.Http.Session)
@import java.time.LocalTime

@main("Home | Keendly") {

  <script type='text/javascript' src='@routes.Assets.at("javascripts/home.js")'></script>
  <div class="container" id="subs-container">
  <form>
      <div class="row">
          <div class="col s12 m6">
              <a class="waves-effect waves-light btn modal-trigger" id="delivery_modal_btn" href="#delivery_modal">Deliver now</a>
              <a class="waves-effect waves-light btn modal-trigger" id="subscription_modal_btn" href="#subscription_modal">Schedule</a>
          </div>
          <div class="input-field col offset-m3 s12 m3" id="search">
              <input id="search_box" type="search" required>
              <label for="search_box"><i class="material-icons">search</i></label>
          </div>
      </div>
      <table class="highlight" id="subscriptions">
          <thead>
          <tr>
              <th></th>
              <th>Title</th>
              <th>Scheduled</th>
              <th class="hide-on-small-only" >Last delivery</th>
          </tr>
          </thead>

          <tbody>
          @for((s, index) <- subscriptions.zipWithIndex){
          <tr>
              <td><input type="checkbox" class="filled-in" id="sub@index" name="@s.providerId" /><label  for="sub@index"></label></td>
              <td class="feed_title">@s.title</td>
              <td>
              @for((key, value) <- s.scheduled){
                  <!--  <p class="tooltipped" data-position="top" data-delay="50" data-tooltip="@value"> -->
                  <a class="modal-trigger schedule_edit" href="#subscription_edit_modal" sid="@value">
                  @key.format(formatter)
                  </a>
                  <!-- </p> -->
              }
              </td>
              <td class="hide-on-small-only" ></td>
          </tr>
          }
          </tbody>
      </table>
  </form>
  </div>

  @deliveryModal
  @subscriptionModal(zones)
  @subscriptionEditModal(zones)
}

@deliveryModal = {
  <div id="delivery_modal" class="modal">
      <div class="modal-content" id="delivery_form">
          <h4>Deliver feeds</h4>
          <div class="progress" id="delivery_progress" style="display: none">
              <div class="indeterminate"></div>
          </div>
          @switch("delivery_mode")
          <div id="simple">
            @includeImages("include_images")
            @markAsRead("mark_as_read")
            @fullArticle("full_article")
            <ul class="collection" id="feed_list">
            </ul>
          </div>
          <div id="detailed" style="display: none">
            <ul class="collection" id="detailed_feed_list">
            </ul>
          </div>
      </div>
      <div class="modal-footer">
          <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
          <a href="#!" class="modal-action waves-effect waves-green btn-flat submit save" id="delivery_save_btn">Deliver</a>
      </div>
  </div>
}

@subscriptionModal(zones: Map[String, Integer]) = {
  <div id="subscription_modal" class="modal">
      <div class="modal-content" id="subscription_form">
          <h4>Schedule delivery</h4> <!-- TODO different title in edit mode -->
          <div class="progress" id="subscription_progress" style="display: none">
              <div class="indeterminate"></div>
          </div>
          @switch("subscription_mode")
          <div id="subscription_simple">
            @includeImages("schedule_include_images")
            @markAsRead("schedule_mark_as_read")
            @fullArticle("schedule_full")
            @times("times_simple")
            @timezones("timezones_simple", zones)
            <label>Feeds included in the delivery:</label>
            <ul class="collection" id="subscription_feed_list">
            </ul>
          </div>
          <div id="subscription_detailed" style="display: none">
            @times("times_detailed")
            @timezones("timezones_detailed", zones)
            <label>Feeds included in the delivery:</label>
            <ul class="collection" id="detailed_subscription_feed_list">
            </ul>
          </div>
      </div>
      <div class="modal-footer">
          <a href="#!" class="modal-action waves-effect waves-green btn-flat submit save" id="subscription_save_btn">Schedule</a>
      </div>
  </div>
}

@subscriptionEditModal(zones: Map[String, Integer]) = {
<div id="subscription_edit_modal" class="modal">
    <div class="modal-content" id="subscription_edit_form">
        <h4>Edit scheduled delivery</h4> <!-- TODO different title in edit mode -->
        <div class="progress" id="subscription_edit_progress" style="display: none">
            <div class="indeterminate"></div>
        </div>
        @switch("subscription_edit_mode")
        <div id="subscription_edit_simple">
            @includeImages("subscription_edit_include_images")
            @markAsRead("subscription_edit_mark_as_read")
            @fullArticle("subscription_edit_full")
            @times("subscription_edit_times_simple")
            @timezones("subscription_edit_timezones_simple", zones)
            <label>Feeds included in the delivery:</label>
            <ul class="collection" id="subscription_edit_feed_list">
            </ul>
        </div>
        <div id="subscription_edit_detailed" style="display: none">
            @times("subscription_edit_times_detailed")
            @timezones("subscription_edit_timezones_detailed", zones)
            <label>Feeds included in the delivery:</label>
            <ul class="collection" id="detailed_subscription_edit_feed_list">
            </ul>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action waves-effect waves-red btn-flat submit" id="subscription_delete_btn">Delete</a>
        <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
        <a href="#!" class="modal-action waves-effect waves-green btn-flat submit" id="subscription_update_btn">Update</a>
        <!-- pass subscription id on save (edit mode) -->
    </div>
</div>
}

@times(id: String) = {
  <p>
      <label>What time you want your feed to be delivered?</label>
      <select id="@id" class="browser-default times">
        @for(i <- 0 until 24) {
          <option>@LocalTime.of(i, 0).format(formatter)</option>
          <option>@LocalTime.of(i, 30).format(formatter)</option>
        }
      </select>
  </p>
}

@timezones(id: String, zones: Map[String, Integer]) = {
  <p>
      <label>What is your timezone?</label>
      <select id="@id" class="browser-default timezones">
          @for((key, value) <- zones){
              <option value="@key" offset="@value">@key</option>
          }
      </select>
  </p>
}

@switch(id: String) = {
  <div class="switch right-align">
      <label>
          Simple
          <input type="checkbox" id="@id">
          <span class="lever"></span>
          Detailed
      </label>
  </div>
}

@includeImages(id: String) = {
  <p>
      <input type="checkbox" class="filled-in" id="@id"/>
      <label for="include_images">Include images</label>
  </p>
}

@markAsRead(id: String) = {
  <p>
      <input type="checkbox" class="filled-in" id="@id" checked="checked"/>
      <label for="mark_as_read">Mark as read</label>
  </p>
}

@fullArticle(id: String) = {
  <p>
      <input type="checkbox" class="filled-in" id="@id" checked="checked"/>
      <label for="full">Full article</label>
  </p>
}
